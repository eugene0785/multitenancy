<!doctype html>
<html lang="ru" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8" />

        <title>Мультиарендность</title>

        <link href="css/impress.css" rel="stylesheet"/>
        <link href="css/prettify.css" rel="stylesheet"/>
        <link href="css/animation.css" rel="stylesheet"/>

        <script src="js/jquery.min.js"></script>
        <script src="js/jmpress.impress.js"></script>
        <script src="js/prettify.js"></script>

    </head>

    <body>
        <div id="impress">
            <div class="step slide" data-x="1500">
                <img id="topdog_logo" src="img/TopDogLogo.png" alt="TopDog Development Ltd"/>
                <h3>Переезжаем в коммуналку:</h3>
                <h3>селим нескольких клиентов в один кластер</h3>
                <br/>
                <br/>
                <div id="left_part">
                    <small>
                        <b>Докладчик:</b><br/>
                        Евгений Бабихин<br/>
                        <a href="mailto:ebabikhin@topdog.ru.net">ebabikhin@topdog.ru.net</a><br/>
                        <a href="http://www.topdog.uk.net">www.topdog.uk.net</a>
                    </small>
                </div>
                <div id="right_part">
                    <small>
                        <b>Ассистент:</b><br/>
                        Андрей Свириденко<br/>
                        <a href="mailto:asv@topdog.ru.net">asv@topdog.ru.net</a><br/>
                        <a href="http://www.topdog.uk.net">www.topdog.uk.net</a>
                    </small>
                </div>
            </div>

            <div class="step" data-x="3000">
                <div id="question">
                    <img src="img/question.gif" alt="Чем мы занимаемся?"/>
                </div>
                <div>
                    <h2 class="question">Чем мы занимаемся?</h2>
                </div>    
            </div>

            <div class="step" data-x="3000" data-y="1100">
                <h2>Программный комплекс
                <img class="header_image" src="img/tdi.jpg" alt="TD-i"/></h2>
                <font data-jmpress="fade">Обеспечивает комплексную автоматизацию деятельности турагентств и туроператоров.<br/><br/>
                Ключевые особенности системы:</font>
                <br/>
                <ul>
                    <li data-jmpress="fade">Многозвенное распределенное приложение на платформе Java EE + PostgreSQL</li><br/>
                    <li data-jmpress="fade">Обеспечивает работу в режиме высокой нагрузки</li><br/>
                    <li data-jmpress="fade">Имеет высокую степень масштабируемости (до 20 серверов в одном кластере)</li>
                </ul>
            </div>

            <div class="step" data-x="3000" data-y="2200">
                <h2>Приложение для колл-центра</h2>
                <div class="large_image">
                    <img src="img/screenshots/TD2.png" alt="Приложение для колл-центра" width="900"/>     
                </div>
            </div>  

            <div class="step" data-x="3000" data-y="3300">
                <h2>Пример B2C веб-сайта</h2>
                <div class="large_image">
                    <img src="img/screenshots/Website.jpg" alt="Пример B2C веб-сайта" width="900"/>     
                </div>
            </div>

            <div class="step" data-x="4500" data-y="0">
                <div id="question">
                    <img src="img/question.gif" alt="Что такое мультиарендность?"/>
                </div>
                <div>
                    <h2 class="question">Что же такое мультиарендность?</h2>
                </div>    
            </div>

            <div class="step" data-x="4500" data-y="1100">
                <h2><img class="header_image" src="img/notepad.png" alt="Определение мультиарендности"/>
                    Определение мультиарендности
                </h2>
                <font><b>Мультиарендность</b> <i>(«multitenancy» — «множественная аренда»)</i> - это принцип построения архитектуры ПО, когда один экземпляр приложения обслуживает множество организаций-клиентов <i>(«арендаторов»)</i></font>
            </div>

            <div class="step" data-x="4500" data-y="2200">
                <h2>Уровни развития мультиарендности</h2>
                <div class="large_image">
                    <img src="img/multitenancy_levels.png" alt="Уровни развития мультиарендности" width="700"/>     
                </div>
            </div>

            <div class="step" data-x="4500" data-y="3300">
                <h2>Мультиарендность ≠ облачные технологии</h2>
                <div class="large_image">
                    <img src="img/throughput.png" alt="Мультиарендность ≠ облачные технологии" width="900"/>     
                </div>
            </div>

            <div class="step" data-x="6000" data-y="0">
                <div id="question">
                    <img src="img/question.gif" alt="Зачем нам понадобилась мультиарендность?"/>
                </div>
                <div>
                    <h2 class="question">Зачем нам понадобилась мультиарендность?</h2>
                </div>
            </div>

            <div class="step" data-x="6000" data-y="1100">
                <h2><img class="header_image" src="img/task.png" alt="Постановка задачи"/>
                    Постановка задачи
                </h2>
                <ul>
                    <li data-jmpress="fade">Крупный туроператор хочет продавать доступ к своей системе Interactive небольшим турагентствам в рамках франшизы</li><br/>
                    <li data-jmpress="fade">Необходимо разграничить доступ к данным этого туроператора</li><br/>
                    <li data-jmpress="fade">Нужно уменьшить стоимость пользования системой для небольших турагентств</li>
                </ul>
            </div>

            <div class="step" data-x="6000" data-y="2200">
                <h2><img class="header_image" src="img/plus.png" alt="Преимущества мультиарендности"/>
                    Преимущества мультиарендности
                </h2>
                <ul>
                    <li data-jmpress="fade">Минимизация инфраструктурных расходов</li><br/>
                    <li data-jmpress="fade">Более рациональное использование аппаратных ресурсов</li><br/>
                    <li data-jmpress="fade">Минимизация дублирования общих данных</li><br/>
                    <li data-jmpress="fade">Хорошая масштабируемость в пределах одного кластера</li><br/>
                </ul>
            </div>

            <div class="step" data-x="6000" data-y="3300">
                <h2><img class="header_image" src="img/minus.png" alt="Недостатки мультиарендности"/>
                    Недостатки мультиарендности
                </h2>
                <ul>
                    <li data-jmpress="fade">Невозможность полностью исключить взаимное влияние клиентов друг на друга</li>
                    <li data-jmpress="fade">Сложность оценки нагрузки, производимой каждым конкретным клиентом</li>
                    <li data-jmpress="fade">Сложность обеспечения полной изоляции данных клиентов</li>
                    <li data-jmpress="fade">Невозможность обновления ПО одного клиента без обновления остальных</li>
                    <li data-jmpress="fade">Сложность переноса клиента на выделенную систему</li>
                </ul>
            </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90">
                <h2><img class="header_image" src="img/architecture.png" alt="Мультиарендная архитектура"/>
                    Мультиарендная архитектура
                </h2>
                <font>Существует 4 вида архитектуры приложения с точки зрения мультиарендности</font>
            </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90" data-z="-1500">
                <h2>Выделенные сервера приложений и БД</h2>
                <div class="large_image">
                    <img src="img/architectures/independent_clients.png" alt="Схема" width="600"/>     
                </div>
           </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90" data-z="-3000">
                <h2>Общий сервер приложений, выделенные БД</h2>
                <div class="large_image">
                    <img src="img/architectures/mutlitenancy_ssdd.png" alt="Схема" width="600"/>     
                </div>
           </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90" data-z="-4500">
                <h2>Выделенные сервера приложений, общая БД</h2>
                <div class="large_image">
                    <img src="img/architectures/mutlitenancy_dssd.png" alt="Схема" width="600"/>     
                </div>
           </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90" data-z="-6000">
                <h2>Общий сервер приложений, общая БД</h2>
                <div class="large_image">
                    <img src="img/architectures/mutlitenancy_sssd.png" alt="Схема" width="600"/>     
                </div>
           </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90" data-z="-7500">
                <h2><img class="header_image" src="img/server.png" alt="Общий сервер приложений"/>
                    Общий сервер приложений
                </h2>
                <font data-jmpress="fade"><img class="small_image" src="img/plus.png" alt="Преимущества"/>
                    Преимущества:
                </font>
                <br/>
                <ul>
                    <li data-jmpress="fade">Рациональное использование аппаратных ресурсов</li>
                    <li data-jmpress="fade">Добавление нового клиента не требует подъема нового сервера</li>
                </ul>
                <font data-jmpress="fade"><img class="small_image" src="img/minus.png" alt="Недостатки"/>
                    Недостатки:
                </font>
                <br/>
                <ul>
                    <li data-jmpress="fade">Нужно знать, в контексте какого клиента выполняется код</li>
                    <li data-jmpress="fade">Высокая степень влияния клиентов друг на друга по производительности</li>
                </ul>
           </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90" data-z="-9000">
                <h2><img class="header_image" src="img/db.png" alt="Общая база данных"/>
                    Общая база данных
                </h2>
                <font data-jmpress="fade">Варианты реализации:</font>
                <br/>
                <ul>
                    <li data-jmpress="fade">Отдельная схема на каждого клиента</li><br/>
                    <li data-jmpress="fade">Отдельный комплект таблиц для каждого клиента</li><br/>
                    <li data-jmpress="fade">Общие таблицы для всех клиентов</li><br/>
                </ul>
           </div>

            <div class="step" data-x="6000" data-y="3300" data-rotate-y="90" data-z="-10500">
                <h2><img class="header_image" src="img/db.png" alt="Общая база данных"/>
                    Общая база данных
                </h2>
                <font data-jmpress="fade"><img class="small_image" src="img/plus.png" alt="Преимущества"/>
                    Преимущества:
                </font>
                <br/>
                <ul>
                    <li data-jmpress="fade">Позволяет объединить максимальное число клиентов на одной СУБД</li>
                    <li data-jmpress="fade">Можно использовать единый пул соединений с БД</li>
                    <li data-jmpress="fade">Удобно выполнять запросы по данным сразу нескольких клиентов</li>
                    <li data-jmpress="fade">Можно легко делать ссылки между общими и частными данными</li>
                </ul>
                <font data-jmpress="fade"><img class="small_image" src="img/minus.png" alt="Недостатки"/>
                    Недостатки:
                </font>
                <br/>
                <ul>
                    <li data-jmpress="fade">Большой размер БД</li>
                    <li data-jmpress="fade">Сложность создания бэкапа данных отдельного клиента</li>
                    <li data-jmpress="fade">Удаление клиента проблематично</li>
                </ul>
           </div>

           <div class="step" data-x="6000" data-y="4400">
                <h2><img class="header_image" src="img/architecture.png" alt="Выбор архитектуры"/>
                    Выбор архитектуры
                </h2>
                <font data-jmpress="fade">Оптимальное решение в нашем случае - общий сервер приложений и общая БД</font>
                <br/>
                <ul>
                    <li data-jmpress="fade">Клиенты относительно небольшие, их взаимным влиянием можно пренебречь</li><br/>
                    <li data-jmpress="fade">Гибкие ограничения на видимость данных между клиентами</li><br/>
                    <li data-jmpress="fade">Архитектура с наличием общих данных хорошо подходит для моделирования франшизы</li><br/>
                    <li data-jmpress="fade">Удаления клиентов происходят нечасто</li><br/>
                    <li data-jmpress="fade">Уже имеется инфраструктура для хранения идентификатора клиента в контексте выполняемого кода</li>
                </ul>
            </div>

           <div class="step" data-x="6000" data-y="5500">
                <h2><img class="header_image" src="img/box.png" alt="Поддержка мультиарендности в Java EE"/>
                    Поддержка мультиарендности в Java EE
                </h2>
                <ul>
                    <li data-jmpress="fade">Спецификация <b>Java EE 7</b> обеспечивает поддержку мультиарендности на уровне всех сервисов, в т.ч. JPA, JMS, EJB, JNDI</li><br/>
                    <li data-jmpress="fade">В <b>Hibernate 4.x</b> штатно поддерживается архитектура с выделенными БД и выделенными схемами внутри одной БД, поддержка общей БД с дискриминатором запланирована в <b>Hibernate 5.0</b></li><br/>
                    <li data-jmpress="fade">В <b>Hibernate 3.x</b> штатной поддержки нет, однако есть механизм фильтров</li><br/>
                </ul>
            </div>

           <div class="step" data-x="6000" data-y="6600">
                <h2><img class="header_image" src="img/box.png" alt="Поддержка мультиарендности на других платформах"/>
                    Поддержка мультиарендности на других платформах
                </h2>
                <ul>
                    <li data-jmpress="fade"><b>C#:</b> nHibernate также имеет механизм фильтров</li><br/>
                    <li data-jmpress="fade"><b>Ruby on Rails:</b> есть фреймворки, решающие проблему мультиарендности на уровне модели данных</li><br/>
                    <li data-jmpress="fade"><b>Python:</b> есть фреймворк для построения мультиарендных веб-сайтов на базе Django</li><br/>
                    <li data-jmpress="fade"><b>PHP:</b> многие CMS могут быть сконфигурированы для работы в мультиарендном режимы (например, Wordpress Multisite, Joomla, Orchard, Drupal и др.)</li>
                </ul>
            </div>

            <div class="step" data-x="7500" data-y="0">
                <h2><img class="header_image" src="img/problems.png" alt="Сложности реализации мультиарендности"/>
                    Сложности реализации мультиарендности
                </h2>
                <ul>
                    <li data-jmpress="fade">Классифицикация модели данных из более, чем 400 сущностей</li>
                    <li data-jmpress="fade">Особого внимания потребовала подсистема отчетов</li>
                    <li data-jmpress="fade">Администраторы системы должны иметь доступ к данным всех клиентов</li>
                    <li data-jmpress="fade">Нужно обеспечить безболезненный механизм миграции любой из имеющихся клиентских систем к новой модели</li>
                    <li data-jmpress="fade">Анализ большого объема кода на предмет наличия идентификатора клиента в текущем контексте</li>
                    <li data-jmpress="fade">Весь функционал системы должны быть протестирован</li>
                </ul>
            </div>

            <div class="step" data-x="7500" data-y="1100">
                <h2><img class="header_image" src="img/results.png" alt="Результаты"/>
                    Результаты
                </h2>
                <ul>
                    <li data-jmpress="fade">Разработка заняла небольшое время (2.5 календарных месяца, или около 6 человеко-месяцев)</li><br/>
                    <li data-jmpress="fade">Общее быстродействие системы не пострадало</li><br/>
                    <li data-jmpress="fade">Примененное решение достаточно элегантно с точки зрения качества кода</li><br/>
                    <li data-jmpress="fade">Технология была успешно внедрена в production</li><br/>
                </ul>
            </div>

            <div class="step" data-x="9000" data-y="0">
                <h2><img class="header_image" src="img/conclusions.png" alt="Выводы"/>
                    Выводы
                </h2>
                <ul>
                    <li data-jmpress="fade">Внедрение технологии позволяет перейти к модели продаж ПО SaaS</li><br/>
                    <li data-jmpress="fade">Затраты на модернизацию системы полностью окупаются за счет снижения инфраструктурных расходов</li><br/>
                    <li data-jmpress="fade">Мультиарендность позволяет снизить порог доступности системы для небольших клиентов</li><br/>
                    <li data-jmpress="fade">Важно уделить особое внимание изоляции клиентов друг от друга</li><br/>
                </ul>
            </div>

            <div class="step" data-x="10500" data-y="0">
                <h2>Спасибо за внимание!</h2>
                <div class="large_image">
                    <img src="img/clouds.jpg" alt="Вперед к облачным технологиям!" width="500"/>     
                </div>    
                <h2>Вперед к облачным технологиям!</h2>
            </div>

        </div>

        <script type="text/javascript">
            $(function() {
                    $('#impress').jmpress({
                        "mouse": { clickSelects: false },
                        "beforeChange": function(element, eventData) {
                            element = $(element);
                            if(element.is('tr')) {
                                element.addClass('visited'); // code should not be hidden after visiting
                            }
                        }
                    });
            });

            prettyPrint();
        </script>
    </body>
</html>




